{"version":3,"file":null,"sources":["../src/canonize.js","../src/index.js"],"sourcesContent":["export default function canonize(url){\n    const re = new RegExp('(https?:)?(\\/\\/)?((rambler)[^\\/]*\\/)?([a-z]*)');\n    const username = url.match(re);\n    return '@'+username[5];\n}","import express from 'express';\nimport canonize from './canonize';\nimport fetch from 'isomorphic-fetch';\nimport Promise from 'bluebird'\n\nconst __DEV__ = true;\nconst app = express();\nconst baseUrl = 'https://pokeapi.co/api/v2';\nconst pokemonField = ['id','name']\n\nasync function getPokemons(url, i = 0) {\n    //console.log('getPokemons', url, i);\n    const response = await fetch(url);\n    const page = await response.json();\n    const pokemons = page.results;\n    if (__DEV__ && i > 1) {\n        return pokemons;\n    }\n    if (page.next) {\n        const pokemons2 = await getPokemons(page.next, i + 1);\n        return [\n            ...pokemons,\n            ...pokemons2\n        ]\n        return pokemons;\n    }\n}\n\n\n\nasync function getPokemonsWeight(id) {\n    const response = await fetch(`${baseUrl}/pokemon/${id}`);\n    const pokemon = await response.json();\n    console.log(pokemon);\n}\n\n//routes\n\napp.get('/canonize', (req, res) => {\n    const username = canonize(req.query.url);\n    res.json({\n        url: req.query.url,\n        user: username\n    })\n});\n\napp.get('/', async (req, res) => {\n    try {\n        const pokemonsUrl = `${baseUrl}/pokemon`;\n        const pokemonsInfo = await getPokemons(pokemonsUrl);\n        const pokemonsPromises = pokemonsInfo.slice(0,2).map(info => {\n            return getPokemon(info.url)\n        })\n        const pokemonsFull = await Promise.all(pokemonsPromises);\n        const pokemons = pokemonsFull.map(pokemon => {\n            return _.pic(pokemon, pokemonField);\n        })\n\n        const sortPokemons = _.sortBy(pokemons, pokemon => pokemon.weight);\n\n        return res.json(sortPokemons);\n\n    }\n    catch(err) {\n        console.log(err);\n    }\n});\n\napp.listen(3000, function () {\n    console.log('Example app listening on port 3000');\n})\n\n//const array = [\n//    'https://rambler.ru/vyvotrin'\n//];\n//array.slice(0,2).forEach((url) => {\n//  const username = canonize(url);\n//  console.log(username);\n//});\n"],"names":["canonize","url","re","RegExp","username","match","i","fetch","response","json","page","results","__DEV__","pokemons","next","getPokemons","pokemons2","id","baseUrl","log","pokemon","getPokemonsWeight","app","express","pokemonField","get","req","res","query","pokemonsUrl","pokemonsInfo","slice","map","getPokemon","info","Promise","all","pokemonsPromises","pokemonsFull","_","pic","sortBy","weight","sortPokemons","listen"],"mappings":";;;;;;;AAAe,SAASA,QAAT,CAAkBC,GAAlB,EAAsB;QAC3BC,KAAK,IAAIC,MAAJ,CAAW,+CAAX,CAAX;QACMC,WAAWH,IAAII,KAAJ,CAAUH,EAAV,CAAjB;WACO,MAAIE,SAAS,CAAT,CAAX;;;;;;0DCOJ,iBAA2BH,GAA3B;YAAgCK,CAAhC,uEAAoC,CAApC;;;;;;;+BAE2BC,MAAMN,GAAN,CAF3B;;;gCAAA;;+BAGuBO,SAASC,IAAT,EAHvB;;;4BAAA;gCAAA,GAIqBC,KAAKC,OAJ1B;;8BAKQC,WAAWN,IAAI,CALvB;;;;;yDAMeO,QANf;;;6BAQQH,KAAKI,IARb;;;;;;+BASgCC,YAAYL,KAAKI,IAAjB,EAAuBR,IAAI,CAA3B,CAThC;;;iCAAA;sFAWeO,QAXf,sBAYeG,SAZf;;;;;;;;;;oBAAeD;;;;;;2DAoBf,kBAAiCE,EAAjC;;;;;;;+BAC2BV,MAASW,OAAT,iBAA4BD,EAA5B,CAD3B;;;gCAAA;;+BAE0BT,SAASC,IAAT,EAF1B;;;+BAAA;;gCAGYU,GAAR,CAAYC,OAAZ;;;;;;;;;;oBAHWC;;;;;;;AA9Bf,AACA,AACA,AACA,AAEA,IAAMT,UAAU,IAAhB;AACA,IAAMU,MAAMC,SAAZ;AACA,IAAML,UAAU,2BAAhB;AACA,IAAMM,eAAe,CAAC,IAAD,EAAM,MAAN,CAArB;;AA8BAF,IAAIG,GAAJ,CAAQ,WAAR,EAAqB,UAACC,GAAD,EAAMC,GAAN,EAAc;QACzBvB,WAAWJ,SAAS0B,IAAIE,KAAJ,CAAU3B,GAAnB,CAAjB;QACIQ,IAAJ,CAAS;aACAiB,IAAIE,KAAJ,CAAU3B,GADV;cAECG;KAFV;CAFJ;;AAQAkB,IAAIG,GAAJ,CAAQ,GAAR;2DAAa,kBAAOC,GAAP,EAAYC,GAAZ;;;;;;;mCAAA,GAEkBT,OAFlB;;+BAGsBH,YAAYc,WAAZ,CAHtB;;;oCAAA;wCAAA,GAIoBC,aAAaC,KAAb,CAAmB,CAAnB,EAAqB,CAArB,EAAwBC,GAAxB,CAA4B,gBAAQ;mCAClDC,WAAWC,KAAKjC,GAAhB,CAAP;yBADqB,CAJpB;;+BAOsBkC,QAAQC,GAAR,CAAYC,gBAAZ,CAPtB;;;oCAAA;gCAAA,GAQYC,aAAaN,GAAb,CAAiB,mBAAW;mCAClCO,EAAEC,GAAF,CAAMpB,OAAN,EAAeI,YAAf,CAAP;yBADa,CARZ;oCAAA,GAYgBe,EAAEE,MAAF,CAAS5B,QAAT,EAAmB;mCAAWO,QAAQsB,MAAnB;yBAAnB,CAZhB;0DAcEf,IAAIlB,IAAJ,CAASkC,YAAT,CAdF;;;;;;gCAkBGxB,GAAR;;;;;;;;KAlBR;;;;;;;AAsBAG,IAAIsB,MAAJ,CAAW,IAAX,EAAiB,YAAY;YACjBzB,GAAR,CAAY,oCAAZ;CADJ;;;;;;;;"}